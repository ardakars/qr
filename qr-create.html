<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Toplu QR ve Mail Gönderme</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; margin: 0; }
    button { font-size: 1em; padding: 5px 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ccc; cursor: pointer; }
    .qr-container { margin: 15px auto; width: 220px; text-align: center; border: 1px solid #ddd; padding: 10px; border-radius: 8px; display: inline-block; }
    .qr-container p { margin: 10px 0 0 0; font-weight: bold; font-size: 1.1em; }
    @media (max-width: 480px) {
      .qr-container { width: 90%; max-width: 250px; margin-bottom: 15px; }
    }
  </style>
</head>
<body>
  <h2>Toplu QR ve Mail Gönderme</h2>
  <button id="generateBtn" disabled>Tüm QR’ları Üret</button>

  <div id="qrList"></div>

  <script>
    let names = [];
    let emails = [];

    fetch('names.txt')
      .then(res => res.text())
      .then(text => {
        const lines = text.split('\n').map(l => l.trim()).filter(l => l.length>0);
        lines.forEach(line => {
          const parts = line.split(';');
          const name = parts[0].trim();
          const email = parts[1] ? parts[1].trim() : '';
          names.push(name);
          emails.push(email);
        });
        document.getElementById('generateBtn').disabled = false;
      });

    function generateAllQR() {
      const qrListDiv = document.getElementById("qrList");
      qrListDiv.innerHTML = "";

      names.forEach((name, idx) => {
        const email = emails[idx];

        const container = document.createElement("div");
        container.className = "qr-container";

        const qrDiv = document.createElement("div");
        container.appendChild(qrDiv);

        const p = document.createElement("p");
        p.textContent = name;
        container.appendChild(p);

        new QRCode(qrDiv, {
          text: encodeURIComponent(name),
          width: 200,
          height: 200,
          correctLevel: QRCode.CorrectLevel.H
        });

        // Mail Gönder butonu
        if(email) {
          const mailBtn = document.createElement("button");
          const qrLink = window.location.origin + '/#'; // QR link placeholder
          mailBtn.textContent = "Mail Gönder";
          mailBtn.onclick = () => {
            const subject = encodeURIComponent("QR Kodunuz");
            const body = encodeURIComponent(`Merhaba ${name},\nQR kodunuz: ${qrLink}`);
            window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
          };
          container.appendChild(mailBtn);
        }

        qrListDiv.appendChild(container);
      });
    }

    document.getElementById('generateBtn').addEventListener('click', generateAllQR);
  </script>
</body>
</html>
